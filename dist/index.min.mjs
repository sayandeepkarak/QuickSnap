function c(e,t,i){return typeof e=="number"&&!isNaN(e)&&e>0?e:typeof e=="string"&&!isNaN(Number(e))&&Number(e)>0?Number(e):(console.warn(`\u26A0\uFE0F Warning: Invalid ${t}. Expected a positive number, but received "${e}". Using default: ${i}.`),i)}function p(e,t,i){if(typeof e=="boolean")return e;if(typeof e=="string"){let n=e.toLowerCase();if(n==="true")return!0;if(n==="false")return!1}return console.warn(`\u26A0\uFE0F Warning: Invalid ${t}. Expected "true" or "false", but received "${e}". Using default: ${i}.`),i}function y(e,t,i,n){let r=Object.values(i);return r.includes(e)?e:(console.warn(`\u26A0\uFE0F Warning: Invalid ${t}. Expected one of [${r.join(", ")}], but received "${e}". Using default: "${n}".`),n)}function v(e,t,i){return typeof e=="string"&&e.trim().length>0?e.trim():(console.warn(`\u26A0\uFE0F Warning: Invalid ${t}. Expected a non-empty string, but received "${e}". Using default: "${i}".`),i)}var d=(e=>(e["image/png"]="image/png",e["image/jpeg"]="image/jpeg",e["image/webp"]="image/webp",e["image/bmp"]="image/bmp",e))(d||{});var E={width:{key:"width",default:640,validate:e=>c(e,"width",640)},height:{key:"height",default:480,validate:e=>c(e,"height",480)},autoStart:{key:"autostart",default:!0,validate:e=>p(e,"autostart",!0)},format:{key:"format",default:"image/png",validate:e=>y(e,"format",d,"image/png")},mediaDeviceId:{key:"mediaDeviceId",default:"",validate:e=>v(e,"mediaDeviceId","")}};var m=class{permission="prompt";currentStatus=null;async askAndGetStream(t,i,n=""){try{let r=await navigator.mediaDevices.getUserMedia({video:{width:{min:320,ideal:i,max:1920},height:{min:240,ideal:t,max:1080},deviceId:n},audio:!1});return this.permission="granted",r}catch(r){return console.error(`QuickSnap Error: ${r}`),this.permission="denied",null}}async watchPermission(t){try{this.currentStatus&&(this.currentStatus.onchange=null),this.currentStatus=await this.fetchPermissionStatus(),this.currentStatus.onchange=()=>{this.currentStatus&&(this.permission=this.currentStatus.state,t(this.permission))}}catch(i){console.error(`QuickSnap Error: ${i}`),this.permission="denied",t(this.permission)}}async fetchPermissionStatus(){return await navigator.permissions.query({name:"camera"})}};var{height:l,width:s,autoStart:a,format:o,mediaDeviceId:u}=E,h=class extends HTMLElement{containerElement;videoElement;overlayElement;webcam=new m;constructor(){super(),this.attachShadow({mode:"open"}),this.containerElement=document.createElement("div"),this.containerElement.style.position="relative",this.containerElement.style.display="inline-block",this.containerElement.style.maxWidth="100%",this.videoElement=document.createElement("video"),this.videoElement.style.height="100%",this.videoElement.style.maxWidth="100%",this.videoElement.setAttribute("playsinline","true"),this.overlayElement=document.createElement("div"),this.overlayElement.style.position="absolute",this.overlayElement.style.top="50%",this.overlayElement.style.left="50%",this.overlayElement.style.transform="translate(-50%, -50%)",this.overlayElement.style.color="#808080a3",this.overlayElement.style.fontSize="16px",this.overlayElement.style.fontWeight="bold",this.overlayElement.style.pointerEvents="none",this.containerElement.appendChild(this.videoElement),this.containerElement.appendChild(this.overlayElement),this.shadowRoot.append(this.containerElement)}static observedAttributes=[l.key,s.key,a.key,o.key,u.key];get width(){return this.hasAttribute(s.key)?s.validate(this.getAttribute(s.key)):s.default}set width(t){this.setAttribute(s.key,s.validate(t).toString()),this.start(!0)}get height(){return this.hasAttribute(l.key)?l.validate(this.getAttribute(l.key)):l.default}set height(t){this.setAttribute(l.key,s.validate(t).toString()),this.start(!0)}get format(){return this.hasAttribute(o.key)?o.validate(this.getAttribute(o.key)).toString():o.default.toString()}set format(t){this.setAttribute(o.key,o.validate(t).toString())}get autoStart(){return this.hasAttribute(a.key)?a.validate(this.getAttribute(a.key)):a.default}set autoStart(t){this.setAttribute(a.key,a.validate(t).toString())}get mediaDeviceId(){return this.hasAttribute(u.key)?u.validate(this.getAttribute(u.key)):u.default}set mediaDeviceId(t){this.setAttribute(u.key,u.validate(t).toString()),this.start(!0)}connectedCallback(){this.setStreamAndWatch()}dispatchCustomEvent(t,i){this.dispatchEvent(new CustomEvent(t,{detail:i}))}onReady(){this.dispatchCustomEvent("ready",{message:"QuickSnap is ready for use."})}onCapture(t){this.dispatchCustomEvent("capture",{message:t?"Snapshot captured successfully.":"Failed to capture snapshot.",data:t})}onError(t){console.error(`QuickSnap Error: ${t}`),this.dispatchCustomEvent("quicksnapError",{message:t})}onPermissionStateUpdate(){this.dispatchCustomEvent("permissionStateUpdate",{status:this.webcam.permission})}async setStreamAndWatch(){this.webcam.watchPermission(t=>{this.onPermissionStateUpdate();let i=t==="granted";this.playOrPauseStream(i),this.showOverlay(!i,t==="denied"?"Permission denied":"Permission required"),i||this.onError(`Camera access ${t==="denied"?"denied by user":"requires permission"}`)}),this.playOrPauseStream(!0,this.autoStart)}async playOrPauseStream(t,i=!0){t&&i?this.start():this.stop()}showOverlay(t,i){this.overlayElement.style.display=t?"inline-block":"none",this.overlayElement.innerText=i??""}start(t=!1){return new Promise(async i=>{if(!this.videoElement.paused&&!t)return i(!0);this.stop();let n=await this.webcam.askAndGetStream(this.height,this.width,this.mediaDeviceId);if(this.onPermissionStateUpdate(),!n?.active)return this.showOverlay(!0,this.webcam.permission==="denied"?"Permission denied":"Permission required"),this.onError(`Camera access ${this.webcam.permission==="denied"?"denied":"required"}`),i(!1);this.videoElement.srcObject=n,this.videoElement.onloadeddata=()=>{let{HAVE_CURRENT_DATA:r,HAVE_ENOUGH_DATA:g,HAVE_FUTURE_DATA:f}=HTMLMediaElement;[r,g,f].includes(this.videoElement.readyState)&&(this.videoElement.play(),this.onReady()),i(!0)}})}pause(){this.videoElement.pause()}resume(){this.videoElement.play()}stop(){let t=this.videoElement.srcObject;t?.active&&(t.getTracks().forEach(i=>i.stop()),this.videoElement.srcObject=null),this.videoElement.pause()}capture(){return new Promise(async t=>{if(!this.videoElement||this.videoElement.readyState<2)return this.onError("Camera is not ready for capturing."),t(null);this.pause(),this.videoElement.style.opacity="0.6",setTimeout(()=>{this.videoElement.style.opacity="1"},100);let i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let n=i.getContext("2d");if(!n)return this.onError("Failed to access canvas for snapshot."),t(null);n.drawImage(this.videoElement,0,0,i.width,i.height),i.toBlob(r=>{this.onCapture(r),t(r)},this.format),this.resume()})}async captureAndDownload(t=""){let i=await this.capture();if(i)try{let n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=t?.length?t:`quick_snap_image_${Date.now()}`,this.containerElement.appendChild(r),r.click(),this.containerElement.removeChild(r),URL.revokeObjectURL(n)}catch(n){console.error(`QuickSnap Error: ${n}`),this.onError("Failed to capture and download snapshot.")}else this.onError("No snapshot available for download.")}async checkPermissions(){try{return(await this.webcam.fetchPermissionStatus()).state}catch(t){return console.error(`QuickSnap Error: ${t}`),this.onError("Failed to check camera permission status"),null}}async getAvailableCameras(){return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}};function b(){customElements.get("quick-snap")||customElements.define("quick-snap",h)}b();
